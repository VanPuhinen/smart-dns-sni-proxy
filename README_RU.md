# üîß Smart DNS & SNI-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Google Gemini –∏ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º

## üìú –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–æ–¥–∏–ª—Å—è –Ω–µ –∏–∑ —É—á–µ–±–Ω–∏–∫–∞, –∞ –∏–∑ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–∫–∏–º —Å–µ—Ä–≤–∏—Å–∞–º, –∫–∞–∫ **Google Gemini (Gemini Advanced)**, –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏, –≥–¥–µ –æ–Ω–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –≠—Ç–æ –∏—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º, –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –æ–∫–∞–∑–∞–ª–∏—Å—å –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã –ø–µ—Ä–µ–¥ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º DPI (Deep Packet Inspection), –∏ –∫–∞–∫ –±—ã–ª–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—á–∞—è, —Ö–æ—Ç—å –∏ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è, —Å–∏—Å—Ç–µ–º–∞.

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–æ—Å—Ç—ã–µ VPN –∏ Shadowsocks –ª–µ–≥–∫–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å. –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π –≤–µ–±-–ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—ã Google (–±—Ä–∞—É–∑–µ—Ä, API) –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ TLS –∏ SNI (Server Name Indication)**. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –∏–º–µ–Ω–Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ –∞–Ω–∞–ª–∏–∑–∞ SNI –≤ TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–∏.

### –†–µ—à–µ–Ω–∏–µ
–ë—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–≤—É—Ö–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
1.  **–õ–æ–∫–∞–ª—å–Ω—ã–π —É–º–Ω—ã–π DNS-—Å–µ—Ä–≤–µ—Ä (AdGuard Home)**: –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–æ–º–µ–Ω–∞–º –∏ "–æ–±–º–∞–Ω—ã–≤–∞–µ—Ç" –∫–ª–∏–µ–Ω—Ç–∞, –ø–æ–¥—Å–æ–≤—ã–≤–∞—è –µ–º—É IP-–∞–¥—Ä–µ—Å –Ω–∞—à–µ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞.
2.  **–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π SNI-–ø—Ä–æ–∫—Å–∏ –Ω–∞ Nginx**: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π TLS-—Ç—Ä–∞—Ñ–∏–∫, —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑ –Ω–µ–≥–æ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ (SNI), –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π —Å–µ—Ä–≤–µ—Ä Google. –î–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ª–µ–≥–∏—Ç–∏–º–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –Ω–∞—à–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º.

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞:**
```
[–í–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä] --DNS--> [AdGuard Home] --DNS –æ—Ç–≤–µ—Ç —Å IP –ø—Ä–æ–∫—Å–∏--> [–í–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä]
[–í–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä] --HTTPS —Ç—Ä–∞—Ñ–∏–∫--> [SNI-–ø—Ä–æ–∫—Å–∏ –Ω–∞ Nginx] --–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ SNI--> [–°–µ—Ä–≤–µ—Ä—ã Google]
```

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

*   **–û–±—Ö–æ–¥ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**: –°–∏—Å—Ç–µ–º–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ DPI –∏ SNI-filtering.
*   **–ù–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: –û—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ –≤–∞—à –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞ —Ä—É–±–µ–∂–æ–º. –†–∞–∑–º–µ—â–µ–Ω–∏–µ AdGuard Home –ª–æ–∫–∞–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —ç—Ç–∞–ø DNS-–∑–∞–ø—Ä–æ—Å–∞.
*   **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã**: AdGuard Home –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Ä–µ–∫–ª–∞–º—ã –∏ —Ç—Ä–µ–∫–µ—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
*   **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ IP-–∞–¥—Ä–µ—Å–æ–≤ Google –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
smart-dns-sni-proxy/
‚îú‚îÄ‚îÄ docker-compose.yml          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ nginx-sni.conf             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SNI-–ø—Ä–æ–∫—Å–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
‚îú‚îÄ‚îÄ nginx-dot.conf            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DNS-over-TLS –ø—Ä–æ–∫—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ update-google-ip.sh   # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è IP Google –≤ –∫–æ–Ω—Ñ–∏–≥–µ
‚îÇ   ‚îî‚îÄ‚îÄ prepare-for-github.sh # –°–∫—Ä–∏–ø—Ç –¥–ª—è "–æ—á–∏—Å—Ç–∫–∏" –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ config-examples/
‚îÇ   ‚îî‚îÄ‚îÄ AdGuardHome.yaml.example # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥–∞ AdGuard Home –ë–ï–ó –ø–∞—Ä–æ–ª–µ–π –∏ –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ .env.example              # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore               # –§–∞–π–ª –¥–ª—è Git, –∏—Å–∫–ª—é—á–∞—é—â–∏–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ README.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ setup.sh                 # –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

## ‚öôÔ∏è –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
*   –°–µ—Ä–≤–µ—Ä –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∑–æ–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å Docker –∏ Docker Compose.
*   –ë–µ–ª—ã–π IP-–∞–¥—Ä–µ—Å –Ω–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
*   –ë–∞–∑–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π Linux.

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repository-url>
cd smart-dns-sni-proxy

# 2. –°–æ–∑–¥–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π–ª —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞
cp .env.example .env
nano .env # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ, —É–∫–∞–∑–∞–≤ —Å–≤–æ–π SERVER_IP –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ

# 3. –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞–±–æ—á–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –∫–æ–Ω—Ñ–∏–≥ AdGuard
mkdir -p adguard-data/conf
cp config-examples/AdGuardHome.yaml.example adguard-data/conf/AdGuardHome.yaml

# 4. –û–¢–ö–†–û–ô–¢–ï –ò –¢–©–ê–¢–ï–õ–¨–ù–û –û–¢–†–ï–î–ê–ö–¢–ò–†–£–ô–¢–ï —ç—Ç–æ—Ç —Ñ–∞–π–ª:
nano adguard-data/conf/AdGuardHome.yaml
```

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `AdGuardHome.yaml`

*   **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –ø–∞—Ä–æ–ª—å**: –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_USERNAME` –∏ `YOUR_PASSWORD_HASH`. –•—ç—à –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π:
    ```bash
    docker run --rm adguard/adguardhome:v0.107.49 hash-password -p 'your_strong_password'
    ```
*   **–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è DNS (rewrites)**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Å–µ–∫—Ü–∏–∏ `filtering -> rewrites` –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ Google (`*.google.com`, `*.googleapis.com` –∏ —Ç.–¥.) –≤ –ø–æ–ª–µ `answer` —É–∫–∞–∑–∞–Ω **IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞** (—Ç–æ—Ç –∂–µ, —á—Ç–æ –≤ `.env`).
*   **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã TLS**: –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DNS-over-TLS, –≤—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ `certificate_chain` –∏ `private_key`.

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
docker compose logs -f sni-proxy
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

1.  **DNS**: –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø, —É–∫–∞–∂–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ç–∏ DNS-—Å–µ—Ä–≤–µ—Ä ‚Äî **IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞**.
2.  **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –Ω–∞ `gemini.google.com`. –¢—Ä–∞—Ñ–∏–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É.

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç SNI-–ø—Ä–æ–∫—Å–∏ (`nginx-sni.conf`)
Nginx –≤ —Ä–µ–∂–∏–º–µ `stream` —Å –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ–ø—Ü–∏–µ–π `ssl_preread on` –º–æ–∂–µ—Ç –∑–∞–≥–ª—è–Ω—É—Ç—å –≤ –Ω–∞—á–∞–ª–æ TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è –∏ –∏–∑–≤–ª–µ—á—å –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞, –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—è –≤–µ—Å—å —Å–µ–∞–Ω—Å. –ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –∏–º–µ–Ω–∏ (—á–µ—Ä–µ–∑ –¥–∏—Ä–µ–∫—Ç–∏–≤—É `map`) –æ–Ω —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

### –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
*   **–ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ TLS-—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—é –∏ SNI-–ø—Ä–æ–∫—Å–∏**: –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Caddy –¥–ª—è –ø—Ä–∏–µ–º–∞ HTTPS –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Nginx —Å–æ–∑–¥–∞–≤–∞–ª–∞ –ª–∏—à–Ω–∏–π —Å–ª–æ–π TLS. –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî SNI-–ø—Ä–æ–∫—Å–∏ (`sni-proxy`) –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç **443 –Ω–∞–ø—Ä—è–º—É—é**.
*   **AdGuard –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å IP –ø—Ä–æ–∫—Å–∏, –∞ –Ω–µ –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞**: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å AdGuard –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç IP Google. –≠—Ç–æ –ª–æ–º–∞–µ—Ç –≤—Å—é —Ü–µ–ø–æ—á–∫—É, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É IP –Ω–∞–ø—Ä—è–º—É—é.
*   **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ IP Google**: IP-–∞–¥—Ä–µ—Å–∞ Google —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –º–µ–Ω—è—é—Ç—Å—è. –°–∫—Ä–∏–ø—Ç `scripts/update-google-ip.sh`, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π –ø–æ cron, —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É.

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
| :--- | :--- | :--- |
| –°–∞–π—Ç—ã Google –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è | AdGuard –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ —Ç–æ—Ç IP | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ü–∏—é `rewrites` –≤ `AdGuardHome.yaml`. |
| | –ë—Ä–∞–Ω–¥–º–∞—É—ç—Ä —Å–µ—Ä–≤–µ—Ä–∞ | –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã 53 (UDP/TCP –¥–ª—è DNS) –∏ 443 (TCP –¥–ª—è HTTPS). |
| | –ó–∞–ø—É—â–µ–Ω —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Caddy | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ: `docker stop caddy-https; docker rm caddy-https`. |
| –û—à–∏–±–∫–∞ `port is already allocated` | –ü–æ—Ä—Ç 443 –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º | –ù–∞–π–¥–∏—Ç–µ –∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç–µ –ø–æ—Ä—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker compose up -d --remove-orphans`. |
| –ù–µ—Ç –ª–æ–≥–æ–≤ –≤ `sni-proxy` | –ó–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –ø–æ—Ä—Ç–∞ 443 | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ `rewrites` –≤ AdGuard. |
| –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ | –í—ã—Å–æ–∫–∏–π –ø–∏–Ω–≥ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ | –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∞—Ä–µ–Ω–¥—É VPS –≤ —Å—Ç—Ä–∞–Ω–µ —Å –ª—É—á—à–∏–º –ø–∏–Ω–≥–æ–º (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –¢—É—Ä—Ü–∏—è). |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
nslookup google.com <IP_–í–ê–®–ï–ì–û_–°–ï–†–í–ï–†–ê>

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ SNI-–ø—Ä–æ–∫—Å–∏ (–∫–ª—é—á–µ–≤—ã–µ —Ñ–ª–∞–≥–∏: --resolve –∏ -k)
curl -vk --resolve "google.com:443:<IP_–í–ê–®–ï–ì–û_–°–ï–†–í–ï–†–ê>" https://google.com

# 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ SNI-–ø—Ä–æ–∫—Å–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f --tail=10 sni-proxy
```

## üîÑ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ IP Google
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ crontab
crontab -e
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–æ–±–Ω–æ–≤–ª—è—Ç—å –≤ 3:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
0 3 * * * cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É && ./scripts/update-google-ip.sh >> ./logs/cron.log 2>&1
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ DNS-over-TLS —Å–æ —Å–≤–æ–∏–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏, –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏—Ö –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `nginx-certs/` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å `dot-proxy`.

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è –∏ –æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **MIT**.

**–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –¥–ª—è –æ–±—Ö–æ–¥–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –º–æ–∂–µ—Ç —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ—Å—Ç–Ω—ã–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º. –î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª—è—Ö. –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Å–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∫–æ–¥–∞.

---

**P.S.** –≠—Ç–æ—Ç `README` ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∞ –∫–æ–Ω—Å–ø–µ–∫—Ç –º–Ω–æ–≥–∏—Ö —á–∞—Å–æ–≤ –ø–æ–∏—Å–∫–∞, –ø—Ä–æ–± –∏ –æ—à–∏–±–æ–∫. –ù–∞–¥–µ—é—Å—å, –æ–Ω —Å—ç–∫–æ–Ω–æ–º–∏—Ç –≤–∞—à–µ –≤—Ä–µ–º—è –∏ –∏–∑–±–∞–≤–∏—Ç –æ—Ç —Ç–µ—Ö –∂–µ "–≥—Ä–∞–±–ª–µ–π", –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—É–ø–∏–ª–∏ –º—ã. –£–¥–∞—á–∏
